<script>
  /*
      // なにかのときよう
      const temp_key =  '10523d0c-a489-4de8-9bb6-742f879739a9';
      const temp_data = {
        start_time: '13:20',
        end_time: '14:50',
        capacity: '2',
        question: [
          {title:"詳細",type:"タイトルと説明",subscription:"カメラ未経験者に向けて、初心者講座を開催します。\n\n実際に一眼レフに触れながら、写真撮影の基礎とテクニックを学びます。"},
          {title:"必須情報",type:"タイトルと説明",subscription:"事前に連絡するため、連絡先等を答えてください。"},
          {required:true,title:"氏名",type:"短文回答"},
          {type:"短文回答",title:"メールアドレス",required:true},
          {title:"学年",required:false,option:["1年","2年","3年","4年"],type:"ラジオボタン"},
          {subscription:"円滑な進行のために、可能な限りご回答ください。",title:"追加情報",type:"タイトルと説明"},
          {required:false,title:"このワークショップに期待するもの",type:"長文回答"},
          {type:"チェックボックス",required:false,title:"お持ちの機器",option:["一眼レフカメラ","ミラーレス","iPhone","スマートフォン（Android））","PC","Adobe"]}
        ],
        date: '2022-10-26',
        subscription: 'カメラ初心者向けの体験講座です',
        location: "青山学院大学相模原キャンパス B422 AIMコモンズ",
        name: 'おためしワークショップ'
      };
      */

      
  function createWorkshop(WORKSHOP, unique_Id, mode){
    // カードのインデックスを取得（modalDivのid用）
    const workshop_index = document.getElementById("containerWorkshop").childElementCount;

    // テンプレートから新規講座を追加
    const TemplateWorkshop = document.getElementById("templateWorkshop");
    var WorkshopContents = TemplateWorkshop.content.cloneNode(true);
    
    // cloneにID付与
    WorkshopContents.querySelector(".workshop-contents").setAttribute("id", unique_Id);
    WorkshopContents.getElementById("openModalBtn").setAttribute("data-bs-target", "#workshop-no"+workshop_index)
    if (mode == "user"){WorkshopContents.getElementById("openModalBtn").innerHTML = "<i class=\"bi bi-calendar-check\"></i>";}
    WorkshopContents.getElementById("modalDiv").id = "workshop-no"+workshop_index;

    const TemplateSaveDeleteBtn = document.getElementById("SaveDeleteBtnTemplate");
    var BtnGroupClone = TemplateSaveDeleteBtn.content.cloneNode(true);
    WorkshopContents.querySelector(".modal-footer").appendChild(BtnGroupClone);

    // 講座情報に合わせて初期値入力
    var workshop_name = WORKSHOP["name"];
    var date = WORKSHOP["date"];
    var start_time = WORKSHOP["start_time"];
    var end_time = WORKSHOP["end_time"];
    var workshop_subs = WORKSHOP["subscription"];
    var location = WORKSHOP["location"]
    var capacity = WORKSHOP["capacity"];
    var question_modules = WORKSHOP["question"];

    // トップページ上のカードを編集
    WorkshopContents.getElementById("card-title").textContent = workshop_name;
    WorkshopContents.getElementById("scheduled").textContent = date + " " + start_time + " ~ " + end_time;
    WorkshopContents.getElementById("card-subs").textContent = workshop_subs;
    
    WorkshopContents.getElementById("workshopLabel").textContent = workshop_name;

    // 必須情報設定モジュールを追加
    const TemplateSettingItem = document.getElementById("moduleSettingItem");
    var SettingModule = TemplateSettingItem.content.cloneNode(true);

    // モーダル内の必須情報を設定
    SettingModule.getElementById("WorkshopName").value = workshop_name;
    SettingModule.getElementById("EventDate").value = date;
    SettingModule.getElementById("StartTime").value = start_time;
    SettingModule.getElementById("EndTime").value = end_time;
    SettingModule.getElementById("WorkshopSubscription").value = workshop_subs;
    SettingModule.getElementById("Location").value = location;
    SettingModule.getElementById("numCapacity").value = capacity;

    const moduleContainerElem = WorkshopContents.querySelector("#module-container");
    moduleContainerElem.appendChild(SettingModule);

    for (let i=0; i < question_modules.length; i++){
      // footer系列テンプレート（クローン）
      var FooterClone = document.getElementById("module-footer").content.cloneNode(true);
      var RequiredSwitchClone = document.getElementById("requiredSwitchTemplate").content.cloneNode(true);
      var DeleteBtnClone = document.getElementById("deleteBtnTemplate").content.cloneNode(true);

      // それぞれのモジュールからクローン
      switch(question_modules[i]["type"]){
        case "タイトルと説明":
          const ModuleTitle = document.getElementById("moduleTitleItem");
          var moduleClone = ModuleTitle.content.cloneNode(true);
          moduleClone.querySelector("#moduleSubscription").value = question_modules[i]["subscription"];
          break;

        case "短文回答":
          const ModuleTextItem = document.getElementById("moduleTextItem");
          var moduleClone = ModuleTextItem.content.cloneNode(true);

          FooterClone.querySelector(".left").appendChild(RequiredSwitchClone);
          FooterClone.querySelector("#requiredSwitch").checked = question_modules[i]["required"];
          break;

        case "長文回答":
          const ModuleParagraphTextItem = document.getElementById("moduleParagraphTextItem");
          var moduleClone = ModuleParagraphTextItem.content.cloneNode(true);
          
          FooterClone.querySelector(".left").appendChild(RequiredSwitchClone);
          FooterClone.querySelector("#requiredSwitch").checked = question_modules[i]["required"];
          break;

        case "ラジオボタン":
          const ModuleChoiceItem = document.getElementById("moduleChoiceItem");
          var moduleClone = ModuleChoiceItem.content.cloneNode(true);

          var option = question_modules[i]["option"]
          var optionConteinerElem = moduleClone.querySelector("#option-container");
          const TemplateChoiceOption = document.getElementById("templateChoiceOptionSetting");
          for (let j=0; j < option.length; j++){
            var OptionClone = TemplateChoiceOption.content.cloneNode(true);
            OptionClone.querySelector("#optiontext").setAttribute("value", option[j]);
            optionConteinerElem.appendChild(OptionClone);
          }

          FooterClone.querySelector(".left").appendChild(RequiredSwitchClone);
          FooterClone.querySelector("#requiredSwitch").checked = question_modules[i]["required"];
          break;

        case "チェックボックス":
          const ModuleCheckboxItem = document.getElementById("moduleCheckboxItem");
          var moduleClone = ModuleCheckboxItem.content.cloneNode(true);

          var option = question_modules[i]["option"]
          var optionConteinerElem = moduleClone.querySelector("#option-container");
          const TemplateCheckboxOption = document.getElementById("templateCheckboxOptionSetting");
          for (let j=0; j < option.length; j++){
            var OptionClone = TemplateCheckboxOption.content.cloneNode(true);
            OptionClone.querySelector("#optiontext").setAttribute("value", option[j]);
            optionConteinerElem.appendChild(OptionClone);
          }

          FooterClone.querySelector(".left").appendChild(RequiredSwitchClone);
          FooterClone.querySelector("#requiredSwitch").checked = question_modules[i]["required"];
          break;
      }
      // 共通初期値をセット
      moduleClone.querySelector("#moduleTitle").value = question_modules[i]["title"];

      // Deleteボタンをフッターに追加
      FooterClone.querySelector(".right").appendChild(DeleteBtnClone);
      moduleClone.querySelector(".card-footer").appendChild(FooterClone);

      // モジュールを追加
      moduleContainerElem.appendChild(moduleClone);
    }

    document.getElementById("containerWorkshop").appendChild(WorkshopContents);

    if (mode == "manager"){
      // 追加されたテンプレートを取得し直し
      const workshopElems = document.getElementById("containerWorkshop").getElementsByClassName("workshop-contents");
      const contentsElem = workshopElems[workshop_index];

      // Addボタングループの各ボタンにモジュール追加機能を付与
      const add_btn = contentsElem.getElementsByClassName("add-new-module");
      for (let i=0; i < add_btn.length; i++){
        add_btn[i].addEventListener('click', addNewModule);
      }

      // Deleteボタンに、モジュール削除機能を付与
      const delete_btn = contentsElem.getElementsByClassName("delete-module");
      for (let i=0; i < delete_btn.length; i++){
        delete_btn[i].addEventListener('click', deleteModule);
      }

      // Saveボタンに機能付与
      const save_btn = contentsElem.getElementsByClassName("save-contents-btn")[0];
      save_btn.addEventListener('click', saveContents);
      const Delete_btn = contentsElem.getElementsByClassName("delete-contents-btn")[0];
      Delete_btn.addEventListener('click', deleteContents);

      // ラジオボタン・チェックボックスのオプション
      // 追加ボタン
      const add_option_btn = contentsElem.getElementsByClassName("add-option");
      for (let i=0; i < add_option_btn.length; i++){
        add_option_btn[i].addEventListener('click', addOption);
      }
      // 削除ボタン
      const delete_option_btn = contentsElem.getElementsByClassName("delete-option");
      for (let i=0; i < delete_option_btn.length; i++){
        delete_option_btn[i].addEventListener('click', deleteOption);
      }
    }
  }
</script>